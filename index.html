<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Soccer Lineup Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8206775175074829"
     crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .field {
            background-image:
                linear-gradient(to bottom, rgba(20, 80, 30, 0.85), rgba(20, 80, 30, 0.85)),
                url('https://placehold.co/1200x800/222/222?text=+');
            background-size: cover;
            background-position: center;
            border: 2px solid #FFF;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative; /* For absolute positioning of players */
        }
        .field.drag-over {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .field-line, .center-circle { border-color: rgba(255, 255, 255, 0.5); }
        .player {
            transition: all 0.2s ease;
            cursor: grab;
            border: 1px solid rgba(255,255,255,0.1);
            width: 80px; /* Fixed width for players */
            height: auto;
        }
        .player.selected, .player:hover {
            background-color: #374151; /* gray-700 */
            border-color: #34d399; /* green-400 */
        }
        .player:active {
            cursor: grabbing;
            transform: scale(1.1);
            z-index: 100;
        }
        .player.on-field {
            position: absolute; /* Players on the field are absolutely positioned */
        }
        .player.on-field .player-stats { display: none; }
        .player.on-field .player-name { font-size: 0.875rem; font-weight: bold; }
        .player.on-field .player-pos { font-size: 0.75rem; }
        
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #4a5568; border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: #34d399; cursor: pointer; border-radius: 50%; }
        input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; background: #34d399; cursor: pointer; border-radius: 50%; }

        @media print {
            body, .max-w-7xl {
                margin: 0;
                padding: 0;
            }
            body > *, #player-form-container, #player-list-container, header, .adsbygoogle, .action-buttons {
                display: none !important;
            }
            main {
                width: 100% !important;
                height: 100vh !important;
                position: absolute;
                top: 0;
                left: 0;
            }
            #field {
                width: 100% !important;
                height: 100% !important;
                border: none !important;
                box-shadow: none !important;
                -webkit-print-color-adjust: exact; /* Chrome, Safari */
                color-adjust: exact; /* Firefox */
            }
            .player.on-field {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            .player.on-field .player-name, .player.on-field .player-pos {
                color: #fff !important; /* Ensure text is visible on dark background */
                text-shadow: 1px 1px 2px #000;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-4 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl lg:text-4xl font-bold text-green-400">AI Soccer Lineup Builder</h1>
            <p class="text-gray-400 mt-2">Add/edit player info and find the optimal combination!</p>
        </header>

        <!-- AdSense Ad Unit -->
        <div class="my-4 flex justify-center">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8206775175074829"
                 crossorigin="anonymous"></script>
            <!-- soccer -->
            <ins class="adsbygoogle"
                 style="display:inline-block;width:728px;height:90px"
                 data-ad-client="ca-pub-8206775175074829"
                 data-ad-slot="9942234276"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Player Management Panel -->
            <aside class="lg:w-1/3 bg-gray-800 p-6 rounded-2xl shadow-lg flex flex-col">
                <!-- Player Input Form -->
                <div id="player-form-container">
                    <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Add / Edit Player</h2>
                    <form id="player-form" class="space-y-3">
                        <input type="hidden" id="playerId">
                        <div>
                            <label for="playerName" class="block text-sm font-medium text-gray-300">Name</label>
                            <input type="text" id="playerName" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 mt-1 text-white" required>
                        </div>
                        <div>
                            <label for="playerPosition" class="block text-sm font-medium text-gray-300">Position</label>
                            <select id="playerPosition" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 mt-1 text-white">
                                <option>FW</option><option>MF</option><option>DF</option><option>GK</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-sm">Shooting: <span id="shootingValue">50</span></label><input type="range" id="shooting" min="1" max="100" value="50"></div>
                            <div><label class="text-sm">Passing: <span id="passingValue">50</span></label><input type="range" id="passing" min="1" max="100" value="50"></div>
                            <div><label class="text-sm">Speed: <span id="speedValue">50</span></label><input type="range" id="speed" min="1" max="100" value="50"></div>
                            <div><label class="text-sm">Stamina: <span id="staminaValue">50</span></label><input type="range" id="stamina" min="1" max="100" value="50"></div>
                            <div><label class="text-sm">Physical: <span id="physicalValue">50</span></label><input type="range" id="physical" min="1" max="100" value="50"></div>
                            <div><label class="text-sm">Defense: <span id="defenseValue">50</span></label><input type="range" id="defense" min="1" max="100" value="50"></div>
                            <div class="col-span-2"><label class="text-sm">Goalkeeping: <span id="goalkeepingValue">50</span></label><input type="range" id="goalkeeping" min="1" max="100" value="50"></div>
                        </div>
                        <div class="flex gap-2 pt-2">
                             <button type="submit" id="add-player-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">Add Player</button>
                             <button type="button" id="update-player-btn" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition hidden">Update Info</button>
                             <button type="button" id="delete-player-btn" class="flex-1 bg-red-800 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition hidden">Delete Player</button>
                             <button type="button" id="clear-form-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition">Cancel</button>
                        </div>
                    </form>
                </div>
                
                <div class="border-t border-gray-700 my-6"></div>

                <!-- Player Roster -->
                <div id="player-list-container">
                    <h2 class="text-2xl font-semibold mb-4">Team Roster</h2>
                    <div id="player-list" class="space-y-3 h-[300px] overflow-y-auto pr-2">
                        <!-- Player cards will be dynamically added here -->
                    </div>
                </div>

                <div class="mt-auto pt-6 action-buttons">
                     <button id="optimize-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        ü§ñ Analyze AI Best Lineup
                    </button>
                     <button id="reset-btn" class="mt-4 w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        üîÑ Reset Field
                    </button>
                     <button id="print-btn" class="mt-4 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        üñ®Ô∏è Print
                    </button>
                     <button id="save-image-btn" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        üñºÔ∏è Save as Image
                    </button>
                </div>
            </aside>

            <!-- Soccer Field -->
            <main class="lg:w-2/3">
                 <div id="field" class="field w-full aspect-[4/3] rounded-2xl p-4">
                    <!-- Field lines (visual elements) -->
                    <div class="absolute top-1/2 left-0 w-full h-px field-line -translate-y-1/2"></div>
                    <div class="absolute top-1/2 left-1/2 w-24 h-24 md:w-32 md:h-32 border-2 rounded-full center-circle -translate-x-1/2 -translate-y-1/2"></div>
                    <div class="absolute top-1/2 left-1/2 w-2 h-2 bg-white rounded-full -translate-x-1/2 -translate-y-1/2"></div>
                    <div class="absolute top-1/2 left-0 w-16 h-32 md:w-24 md:h-48 border-2 border-l-0 rounded-r-2xl field-line -translate-y-1/2"></div>
                    <div class="absolute top-1/2 right-0 w-16 h-32 md:w-24 md:h-48 border-2 border-r-0 rounded-l-2xl field-line -translate-y-1/2"></div>
                    <!-- Players will be placed here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"><div class="bg-white text-gray-800 p-6 rounded-lg shadow-xl text-center w-11/12 md:w-1/3"><p id="message-text" class="text-lg font-medium"></p><button id="close-modal-btn" class="mt-6 bg-green-600 text-white px-6 py-2 rounded-lg font-bold">OK</button></div></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Data & Variable Initialization ---
    let players = []; // Start with an empty player list.

    const playerList = document.getElementById('player-list');
    const field = document.getElementById('field');
    const optimizeBtn = document.getElementById('optimize-btn');
    const resetBtn = document.getElementById('reset-btn');
    const printBtn = document.getElementById('print-btn');
    const saveImageBtn = document.getElementById('save-image-btn');
    const messageModal = document.getElementById('message-modal');
    const messageText = document.getElementById('message-text');
    const closeModalBtn = document.getElementById('close-modal-btn');

    // Form elements
    const playerForm = document.getElementById('player-form');
    const playerIdInput = document.getElementById('playerId');
    const playerNameInput = document.getElementById('playerName');
    const playerPositionInput = document.getElementById('playerPosition');
    const addPlayerBtn = document.getElementById('add-player-btn');
    const updatePlayerBtn = document.getElementById('update-player-btn');
    const deletePlayerBtn = document.getElementById('delete-player-btn');
    const clearFormBtn = document.getElementById('clear-form-btn');

    const statInputs = { shooting: document.getElementById('shooting'), passing: document.getElementById('passing'), speed: document.getElementById('speed'), stamina: document.getElementById('stamina'), physical: document.getElementById('physical'), defense: document.getElementById('defense'), goalkeeping: document.getElementById('goalkeeping'), };
    const statValueSpans = { shooting: document.getElementById('shootingValue'), passing: document.getElementById('passingValue'), speed: document.getElementById('speedValue'), stamina: document.getElementById('staminaValue'), physical: document.getElementById('physicalValue'), defense: document.getElementById('defenseValue'), goalkeeping: document.getElementById('goalkeepingValue'), };

    let draggedPlayer = null;

    // --- Function Definitions ---

    function renderPlayers() {
        playerList.innerHTML = '';
        const onFieldIds = new Set([...field.querySelectorAll('.player')].map(p => p.id));

        players.forEach(player => {
            if (!onFieldIds.has(player.id)) {
                const playerCard = createPlayerCard(player);
                playerList.appendChild(playerCard);
            }
        });
        addDragEventsToAllPlayers();
        addClickEventsToPlayersInList();
    }
    
    function createPlayerCard(player) {
        const playerCard = document.createElement('div');
        playerCard.id = player.id;
        playerCard.className = 'player bg-gray-700 p-2 rounded-lg flex flex-col text-center shadow-md';
        playerCard.draggable = true;
        playerCard.innerHTML = `
            <div class="text-center">
                <p class="font-bold player-name">${player.name}</p>
                <p class="text-sm text-gray-400 player-pos">${player.position}</p>
            </div>
            <div class="grid grid-cols-3 gap-x-2 gap-y-1 mt-2 text-xs player-stats">
                <span class="text-blue-300">Shooting: ${player.stats.shooting}</span><span class="text-green-300">Passing: ${player.stats.passing}</span><span class="text-yellow-300">Speed: ${player.stats.speed}</span><span class="text-orange-300">Stamina: ${player.stats.stamina}</span><span class="text-purple-300">Physical: ${player.stats.physical}</span><span class="text-red-300">Defense: ${player.stats.defense}</span>
            </div>
        `;
        return playerCard;
    }

    // Player Form Functions (Add/Update/Delete)
    function handleFormSubmit(e) { e.preventDefault(); const newPlayer = { id: 'p' + Date.now(), name: playerNameInput.value, position: playerPositionInput.value, stats: {} }; for (const key in statInputs) { newPlayer.stats[key] = parseInt(statInputs[key].value, 10); } players.push(newPlayer); renderPlayers(); clearForm(); showMessage(`${newPlayer.name} has been added.`); }
    function handleUpdatePlayer() { const id = playerIdInput.value; const playerIndex = players.findIndex(p => p.id === id); if (playerIndex > -1) { players[playerIndex].name = playerNameInput.value; players[playerIndex].position = playerPositionInput.value; for (const key in statInputs) { players[playerIndex].stats[key] = parseInt(statInputs[key].value, 10); } const playerCardOnField = document.getElementById(id); if (playerCardOnField) { playerCardOnField.querySelector('.player-name').textContent = players[playerIndex].name; playerCardOnField.querySelector('.player-pos').textContent = players[playerIndex].position; } renderPlayers(); clearForm(); showMessage('Player info has been updated.'); } }
    function handleDeletePlayer() { const id = playerIdInput.value; if (confirm('Are you sure you want to delete this player?')) { players = players.filter(p => p.id !== id); const playerCard = document.getElementById(id); if (playerCard) { playerCard.remove(); } renderPlayers(); clearForm(); showMessage('Player has been deleted.'); } }
    function clearForm() { playerForm.reset(); playerIdInput.value = ''; for (const key in statValueSpans) { statInputs[key].value = 50; statValueSpans[key].textContent = '50'; } addPlayerBtn.classList.remove('hidden'); updatePlayerBtn.classList.add('hidden'); deletePlayerBtn.classList.add('hidden'); document.querySelectorAll('.player.selected').forEach(p => p.classList.remove('selected')); }
    function populateForm(player) { clearForm(); document.querySelectorAll('.player.selected').forEach(p => p.classList.remove('selected')); document.getElementById(player.id)?.classList.add('selected'); playerIdInput.value = player.id; playerNameInput.value = player.name; playerPositionInput.value = player.position; for (const key in player.stats) { statInputs[key].value = player.stats[key]; statValueSpans[key].textContent = player.stats[key]; } addPlayerBtn.classList.add('hidden'); updatePlayerBtn.classList.remove('hidden'); deletePlayerBtn.classList.remove('hidden'); }
    function updateStatValue(e) { const statName = e.target.id; statValueSpans[statName].textContent = e.target.value; }

    // Drag & Drop Event Handlers
    function handleDragStart(e) { draggedPlayer = e.target; setTimeout(() => { e.target.style.opacity = '0.5'; }, 0); }
    function handleDragEnd(e) { e.target.style.opacity = '1'; draggedPlayer = null; }
    function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
    function handleDragLeave(e) { e.currentTarget.classList.remove('drag-over'); }
    function handleDrop(e) { e.preventDefault(); const dropZone = e.currentTarget; dropZone.classList.remove('drag-over'); if (!draggedPlayer) return; if (dropZone.id === 'field') { const rect = dropZone.getBoundingClientRect(); let x = e.clientX - rect.left; let y = e.clientY - rect.top; x -= draggedPlayer.offsetWidth / 2; y -= draggedPlayer.offsetHeight / 2; x = Math.max(0, Math.min(x, dropZone.clientWidth - draggedPlayer.offsetWidth)); y = Math.max(0, Math.min(y, dropZone.clientHeight - draggedPlayer.offsetHeight)); dropZone.appendChild(draggedPlayer); draggedPlayer.classList.add('on-field'); draggedPlayer.style.position = 'absolute'; draggedPlayer.style.left = x + 'px'; draggedPlayer.style.top = y + 'px'; } else if (dropZone.id === 'player-list') { draggedPlayer.classList.remove('on-field'); draggedPlayer.style.position = 'static'; draggedPlayer.style.left = ''; draggedPlayer.style.top = ''; dropZone.appendChild(draggedPlayer); } renderPlayers(); }
    
    function addDragEventsToAllPlayers() { document.querySelectorAll('.player').forEach(player => { player.addEventListener('dragstart', handleDragStart); player.addEventListener('dragend', handleDragEnd); }); }
    function addClickEventsToPlayersInList() { document.querySelectorAll('#player-list .player').forEach(playerCard => { playerCard.addEventListener('click', () => { const player = players.find(p => p.id === playerCard.id); if (player) populateForm(player); }); }); }

    // AI Optimization Logic
    function optimizeLineup() {
        if (players.length < 11) {
            showMessage('At least 11 players are required for AI optimization.');
            return;
        }
        resetField();
        let availablePlayers = players.map(p => ({...p}));
        const assignedPlayerIds = new Set();
        
        const formation = {
            'GK': {role: 'goalkeeper', pos: { top: '85%', left: '50%' }},
            'LCB': {role: 'defense', pos: { top: '70%', left: '35%' }}, 'RCB': {role: 'defense', pos: { top: '70%', left: '65%' }},
            'LB': {role: 'defense', pos: { top: '68%', left: '15%' }}, 'RB': {role: 'defense', pos: { top: '68%', left: '85%' }},
            'CDM': {role: 'midfield', pos: { top: '55%', left: '50%' }},
            'LCM': {role: 'midfield', pos: { top: '45%', left: '30%' }}, 'RCM': {role: 'midfield', pos: { top: '45%', left: '70%' }},
            'LW': {role: 'attack', pos: { top: '25%', left: '20%' }}, 'RW': {role: 'attack', pos: { top: '25%', left: '80%' }},
            'ST': {role: 'attack', pos: { top: '18%', left: '50%' }}
        };

        Object.keys(formation).forEach(positionKey => {
            const { role, pos } = formation[positionKey];
            let bestPlayer = null;
            let maxScore = -1;

            availablePlayers.forEach(player => {
                if (!assignedPlayerIds.has(player.id)) {
                    const s = player.stats;
                    let score = 0;
                    if (role === 'goalkeeper') { score = s.goalkeeping; }
                    else if (role === 'attack') { score = s.shooting * 1.5 + s.speed * 1.2 + s.physical * 1.1 + s.passing * 0.8; }
                    else if (role === 'midfield') { score = s.passing * 1.5 + s.stamina * 1.3 + s.defense * 1.0 + s.shooting * 0.8; }
                    else { score = s.defense * 1.5 + s.physical * 1.3 + s.stamina * 1.1 + s.passing * 0.7; }
                    if (score > maxScore) { maxScore = score; bestPlayer = player; }
                }
            });

            if (bestPlayer) {
                assignedPlayerIds.add(bestPlayer.id);
                const playerCard = createPlayerCard(bestPlayer);
                field.appendChild(playerCard);
                playerCard.classList.add('on-field');
                playerCard.style.position = 'absolute';
                playerCard.style.top = pos.top;
                playerCard.style.left = pos.left;
                playerCard.style.transform = 'translateX(-50%)';
            }
        });
        renderPlayers();
        showMessage('AI has placed the optimal lineup. Feel free to make adjustments!');
    }
    
    function resetField() { [...field.querySelectorAll('.player')].forEach(playerCard => { playerCard.remove(); }); renderPlayers(); }
    function showMessage(message) { messageText.textContent = message; messageModal.classList.remove('hidden'); }
    function hideMessage() { messageModal.classList.add('hidden'); }

    // --- Event Listener Registration ---
    field.addEventListener('dragover', handleDragOver); field.addEventListener('dragleave', handleDragLeave); field.addEventListener('drop', handleDrop);
    playerList.addEventListener('dragover', handleDragOver); playerList.addEventListener('dragleave', handleDragLeave); playerList.addEventListener('drop', handleDrop);
    playerForm.addEventListener('submit', handleFormSubmit);
    updatePlayerBtn.addEventListener('click', handleUpdatePlayer);
    deletePlayerBtn.addEventListener('click', handleDeletePlayer);
    clearFormBtn.addEventListener('click', clearForm);
    optimizeBtn.addEventListener('click', optimizeLineup);
    resetBtn.addEventListener('click', () => { resetField(); showMessage('Field has been reset.'); });
    closeModalBtn.addEventListener('click', hideMessage);
    for (const key in statInputs) { statInputs[key].addEventListener('input', updateStatValue); }
    
    printBtn.addEventListener('click', () => window.print());
    saveImageBtn.addEventListener('click', () => {
        const originalShadow = field.style.boxShadow;
        field.style.boxShadow = 'none';
        html2canvas(field).then(canvas => {
            field.style.boxShadow = originalShadow;
            const image = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = image;
            link.download = 'lineup.png';
            link.click();
        });
    });

    // --- App Start ---
    renderPlayers();
});
</script>

</body>
</html>
